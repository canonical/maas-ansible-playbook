---
# Playbook to generate a MAAS region

- hosts: maas-region-controllers

  vars_prompt:
    - name: maas_installation_type
      prompt: Install MAAS from [deb] or [snap]?
      default: "snap"
      private: false

    - name: maas_version
      prompt: Version of MAAS to install
      default: "latest"
      private: false

    - name: maas_snap_channel
      prompt: Channel of MAAS to install
      default: "stable"
      private: false

    - name: install_metrics
      prompt: Install metrics? [Y/N]
      default: "y"
      private: false

  tasks:

    - name: "Check if MAAS is installed"
      package_facts:
        manager: "auto"

    - name: "Install maas"
      import_tasks: install_maas.yaml
      when: "'maas' not in ansible_facts.packages"

    - name: "Update maas"
      import_tasks: update_maas.yaml
      when: "'maas' in ansible_facts.packages"

    - name: Install maas metrics
      when: install_metrics | lower == "y"
      import_tasks: metrics.yaml
