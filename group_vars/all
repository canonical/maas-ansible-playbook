# Global variable file for Ansible playbooks

# Standard MAAS Variables
maas_port: 5240             # The port MAAS uses to comunicate on
maas_https_port: 5443       # The https port MAAS uses to comunicate on
maas_url: ""                # The URL MAAS uses
enable_tls: false           # Use TLS for MAAS communication
vault_integration: false    # Use MAAS vault for secret storage
install_metrics: false           # install metrics for the MAAS

# MAAS Vault configuration
vault_url: ""                 # The URL of the MAAS Vault
vault_approle_id: ""          # The approle ID used for MAAS Vault
vault_wrapped_token: ""
vault_secrets_path: ""
vault_secret_mount: ""

# Installation variables
maas_install_deb: "{{ maas_installation_type == 'deb' }}"
maas_version: "latest"          # ie: 3.2, 2.8
maas_snap_channel: "stable"     # if using snap, then the channel. ie: stable, beta, edge
maas_deb_state: "present"       # if using deb, the state for install
maas_state: "install"           # whether to install, or upgrade maas
uninstall_pip: false            # Whether to uninstall pip when executing the teardown action

# grafana agent repo
grafana_agent_pkg: https://github.com/grafana/agent/releases/download/v0.22.0/agent-linux-amd64.zip

maas_postgres_user: "maas"
maas_postgres_database: "maasdb"
maas_ha_postgres_enabled: true

maas_postgres_uri_login: "{{ maas_postgres_user }}:{{ maas_postgres_password }}"

maas_postgres_proxy_host_v4: "{{ hostvars[groups['maas_postgres_proxy'][0]]['ansible_default_ipv4']['address'] if (groups['maas_postgres_proxy']) and hostvars[groups['maas_postgres_proxy'][0]]['ansible_default_ipv4'] is defined and hostvars[groups['maas_postgres_proxy'][0]]['ansible_default_ipv4']['address'] is defined else ''}}"

maas_postgres_proxy_host_v6: "{{ hostvars[groups['maas_postgres_proxy'][0]]['ansible_default_ipv6']['address'] if (groups['maas_postgres_proxy']) and hostvars[groups['maas_postgres_proxy'][0]]['ansible_default_ipv6'] is defined and hostvars[groups['maas_postgres_proxy'][0]]['ansible_default_ipv6']['address'] is defined else ''}}"

maas_postgres_proxy_uri: "postgres://{{ maas_postgres_uri_login }}@{{ maas_postgres_proxy_host_v4 if maas_postgres_proxy_host_v4 else maas_postgres_proxy_host_v6 }}:5432/{{ maas_postgres_database }}"

maas_postgres_primary_host_v4: "{{ hostvars[groups['maas_postgres'][0]]['ansible_default_ipv4']['address'] if hostvars[groups['maas_postgres'][0]]['ansible_default_ipv4'] is defined and hostvars[groups['maas_postgres'][0]]['ansible_default_ipv4']['address'] is defined else ''}}"
maas_postgres_primary_host_v6: "{{ hostvars[groups['maas_postgres'][0]]['ansible_default_ipv6']['address'] if hostvars[groups['maas_postgres'][0]]['ansible_default_ipv6'] is defined and hostvars[groups['maas_postgres'][0]]['ansible_default_ipv6']['address'] is defined else ''}}"
maas_postgres_primary_uri: "postgres://{{ maas_postgres_uri_login }}@{{ maas_postgres_primary_host_v4 if maas_postgres_primary_host_v4 else maas_postgres_primary_host_v6 }}:5432/{{ maas_postgres_database }}"


maas_postgres_uri: "{{ maas_postgres_proxy_uri if (groups['maas_postgres_proxy']) else maas_postgres_primary_uri }}"

maas_postgres_backup_dir: "/tmp/maas_backup/" 
maas_postgres_backup_path: "{{ maas_postgres_backup_dir }}dump.sql.gz"
maas_config_backup_path: "{{ '/etc/maas/' if maas_install_deb | bool else '' }}"
maas_runtime_backup_path: "{{ '/var/lib/maas/' if maas_install_deb | bool else '' }}"
maas_exclude_backup_path: "{{ '/var/lib/maas/boot-resources/' if maas_install_deb | bool else '' }}"
maas_backup_dest_path: "/tmp/{{ inventory_hostname }}_maas_backup_{{ ansible_date_time.iso8601 }}.tgz"
maas_restore_config_path: "{{ '/etc/maas' if maas_install_deb | bool else '' }}"
maas_restore_runtime_path: "{{ '/var/lib/maas' if maas_install_deb | bool else '' }}"

maas_secret_file: "{{ '/var/snap/maas/common' if  maas_installation_type | lower == 'snap' else '/var/lib' }}/maas/secret"

maas_installmetric_file: "{{ '/var/snap/maas/common' if maas_installation_type | lower == 'snap' else '/var/lib/maas' }}/.ansible"
